/**
*date:2020-09-28
*/

## [webpackå®˜ç½‘](https://www.webpackjs.com/concepts/)
## webpackå­¦ä¹ è®°å½•
    ä½¿ç”¨webpackæ—¶é—´ä¹Ÿä¸çŸ­äº†ï¼Œä½†æ˜¯ä»æ¥éƒ½æ˜¯å†™ä¸šåŠ¡ä¹‹ç±»çš„ï¼Œé¡¹ç›®æ¡†æ¶ä»€ä¹ˆçš„éƒ½æ˜¯è€å¤§åœ¨æï¼Œæ‰€ä»¥æƒ³æŠ½å‡ºæ¥ç‚¹æ—¶é—´è‡ªå·±å­¦ä¹ ä¸‹.webpackç°åœ¨æ˜¯å‰ç«¯å·¥ç¨‹åŒ–ä¸­é‡è¦çš„ä¸€ä¸ªæŠ€æœ¯ï¼Œå¦‚æœä¸ç”¨æˆ–è€…ä¸å­¦ä¹ å°±æœ‰ç‚¹è·Ÿä¸ä¸ŠèŠ‚å¥äº†ï¼Œå¸Œæœ›è‡ªå·±ä¸è¦â€˜ä¸€ğŸè¿å¾™â€™ã€‚

#### webpackå¯ä»¥åšå“ªäº›äº‹æƒ…
    ä»£ç è½¬æ¢ï¼šå°†æˆ‘ä»¬çš„es6ä»£ç è½¬æ¢ä¸ºes5
    æ–‡ä»¶ä¼˜åŒ–: å‹ç¼©ä»£ç ä½“ç§¯
    ä»£ç åˆ†å‰²ï¼šå°†jsã€cssã€htmlåˆ†å¼€æ‰“åŒ…
    æ¨¡å—åˆå¹¶ï¼šå°†å¤šä¸ªæ¨¡å—åˆå¹¶ä¸ºä¸€ä¸ªæ¨¡å—
    è‡ªåŠ¨åˆ·æ–°: é€šè¿‡webpack-dev-serverå¯åŠ¨æœ¬åœ°æœåŠ¡å®ç°ä»£ç åˆ·æ–°ã€çƒ­æ›´æ–°
    ä»£ç æ ¡éªŒï¼šæ ¡éªŒæˆ‘ä»¬çš„ä»£ç æ˜¯å¦è§„èŒƒ
    è‡ªåŠ¨å‘å¸ƒï¼šéœ€è¦ä¸€ä¸ªæ’ä»¶å°†æˆ‘ä»¬æ‰“åŒ…åçš„ä»£ç å‘å¸ƒåˆ°æœåŠ¡å™¨ä¸Š

#### æˆ‘ä»¬åº”è¯¥å­¦ä¹ äº›ä»€ä¹ˆ
    webpackå¸¸è§é…ç½®
    webpacké«˜çº§é…ç½®
    webpackä¼˜åŒ–ç­–ç•¥
    astæŠ½è±¡è¯­æ³•æ ‘(webpackå¦‚ä½•è§£æ)
    webpackä¸­çš„Tapable(äº‹ä»¶æµ)
    æŒæ¡webpackæµç¨‹ï¼Œæ‰‹å†™webpack
    å¯ä»¥å®ç°å¸¸ç”¨çš„loader
    å¯ä»¥å®ç°å¸¸ç”¨çš„plugin

## ä¸€.webpackå®‰è£…
### 1.1å®‰è£…æœ¬åœ°çš„webpack
    $ yarn add webpack webpack-cli -D
    # è¿™é‡Œè‚¯å®šæœ‰äººä¼šé—®ä¸ºä»€ä¹ˆè¿˜è¦å®‰è£…webpack-cliï¼‰å› ä¸ºwebpack-dev-serverè¢«æ”¾åœ¨äº†webpack-cli

    $ -D === --save-dev
    # è¿™ä¸ªè¡¨ç¤ºä¸Šçº¿æ—¶ä¸éœ€è¦æ­¤ä»¥æ¥åªæ˜¯åœ¨å¼€å‘ç¯å¢ƒä¸­ä¼šç”¨åˆ° -S === --save è¿™ä¸ªæ˜¯ä¸Šçº¿ä¹Ÿéœ€è¦æ­¤ä¾èµ–. é»˜è®¤æ˜¯--save

    $ mkdir webpack && cd webpack  -> yarn init -y
    # åˆ›å»ºåä¸ºwebpackçš„æ–‡ä»¶å¹¶ä¸”åˆ‡æ¢åˆ°æ­¤æ–‡ä»¶ åç»­åœ¨åˆå§‹åŒ–ä¸€ä¸ªpackage.jsonåŒ…ç®¡ç†æ–‡ä»¶ -yæ˜¯ç›´æ¥ç”Ÿæˆé»˜è®¤çš„ä¸éœ€è¦è¯¢é—®é‡Œé¢çš„æ¯ä¸€é¡¹ã€‚

### 1.2webpackå¯ä»¥è¿›è¡Œ0é…ç½®ä½¿ç”¨
    æ‰“åŒ…å·¥å…· -> è¾“å‡ºåçš„ç»“æœ(jsæ¨¡å—)
    # æˆ‘ä»¬åœ¨æˆ‘ä»¬åˆšæ‰å®‰è£…webpackæˆåŠŸçš„ç›®å½•ä¸‹æ–°å»ºä¸€ä¸ªsrcç›®å½•ä¸‹é¢æ–°å»ºä¸€ä¸ªindex.jsæ–‡ä»¶

```
# index.jsæ–‡ä»¶å†…å®¹
$ console.log('å­¦ä¹ webpackçš„å†…å®¹');

# æ‰“åŒ…æ–‡ä»¶index.js
$ npx webpack

# ä¸ºä»€ä¹ˆï¼Ÿå› ä¸ºæˆ‘ä»¬æ‰§è¡Œæ­¤å‘½ä»¤çš„æ—¶å€™ä»–æ˜¯å…ˆå»node_modulesä¸­æ‰¾.binä¸­çš„webpack.cmd
# ä»£ç çš„å¤§æ¦‚æ„æ€å°±æ˜¯ é¦–å…ˆåˆ¤æ–­æ˜¯å¦æœ‰node.exeï¼Œå¦‚æœæ²¡æœ‰å°±å»node_modules/webpack/webpack.js,è¿™é‡Œå°±éœ€è¦ç”¨åˆ°webpack-cli
```

    æ‰§è¡Œå®Œä»£ç åå‘ç°æˆ‘ä»¬çš„é¡¹ç›®ç›®å½•ä¸‹é¢æœ‰ä¸€ä¸ªdistç›®å½•ä¸‹é¢å¤šäº†ä¸€ä¸ªmain.js

### 1.3æ‰‹åŠ¨é…ç½®webpack
    é»˜è®¤é…ç½®æ–‡ä»¶çš„åå­—æ˜¯webpack.config.js;æˆ‘ä»¬åœ¨é¡¹ç›®çš„æ ¹ç›®å½•ä¸‹æ–°å»ºwebpack.config.jsçš„æ–‡ä»¶
    
    æˆ‘ä»¬ä¹Ÿå¯ä»¥ä¸èµ·è¿™ä¸ªåå­— å¯ä»¥ä½¿ç”¨å…¶ä»–çš„åå­—æ¯”å¦‚node_modules/webpack-cli/config-yargs.jsä¸­æœ‰è¯´åˆ°ä¹Ÿå¯ä»¥æ˜¯webpackfile.js å½“ç„¶æˆ‘ä»¬ä¹Ÿå¯ä»¥èµ·å…¶ä»–çš„åå­—ä¹‹åæ‰“åŒ…çš„æ—¶å€™é€šè¿‡å‚æ•°çš„å½¢å¼å‘Šè¯‰webpackä½¿ç”¨å“ªä¸ªé…ç½®æ–‡ä»¶ 

```bash
//  webpackæ˜¯nodeå†™å‡ºæ¥çš„ æ‰€ä»¥æˆ‘ä»¬ä¹Ÿè¦é‡‡ç”¨nodeçš„å†™æ³•
let path = require('path'); // å¼•å…¥è·¯å¾„æ¨¡å—
module.exports = {
    mode: 'production',
    entry: './src/index.js', // å…¥å£æ–‡ä»¶ webpackæ˜¯é€šè¿‡è¿™ä¸ªå…¥å£å»é€æ­¥å°†æ‰€æœ‰jsæ–‡ä»¶ä»¥åŠå…¶ä»–æ–‡ä»¶æ‰“åŒ…èµ·æ¥ çš„. è¿™é‡Œä½¿ç”¨çš„æ˜¯ç›¸å¯¹è·¯åŠ²
    output: { 
        filename: 'bundle.[hash:8].js', // æ‰“åŒ…åçš„æ–‡ä»¶åç§°
        path: path.resolve(__dirname, 'dist'), // æ‰“åŒ…åçš„è·¯å¾„å°±æ˜¯æ–‡ä»¶æ”¾åœ¨å“ªé‡Œ å¿…é¡»æ˜¯ä¸€ä¸ªç»å¯¹è·¯å¾„ __dirnameæ˜¯æŒ‡å½“å‰ç›®å½•ä¸‹
    },
    plugins: [// æ”¾ç€æ‰€æœ‰çš„webpackæ’ä»¶
        new HtmlWebpackPlugin({
            template: './src/index.html',
            filename: 'index.html',
            minify: { //é…ç½®å‹ç¼©ä»£ç éœ€è¦æ˜¯productionç¯å¢ƒ
                removeAttributeQuotes: true, // åˆ é™¤æ‰htmlä¸­çš„åŒå¼•å·
                collapsWhitespace: true, // æ‰“åŒ…å‡ºæ¥çš„htmlæ–‡ä»¶æ˜¾ç¤ºåœ¨ä¸€è¡Œ
            },
            hash: true,// æ¯ä¸ªæ–‡ä»¶åéƒ½å¸¦hash
        })
    ]
}
```
#### 1.3.1webpack-dev-serveræ¥è¿›è¡Œå¯åŠ¨ä¸€ä¸ªæœ¬åœ°æœåŠ¡
    æˆ‘ä»¬éœ€è¦ä½¿ç”¨æ’ä»¶æ¥å¹²è¿™ä»¶äº‹æƒ…ï¼Œè¿™ä¸ªå†…ç½®çš„webpack-dev-serveræ˜¯é€šè¿‡expressæ¥å®ç°çš„
    å®‰è£…ï¼š yarn add webpack-dev-server -D
    å¯åŠ¨ï¼š npx webpack-dev-server æˆ‘ä¼šå‘ç°æˆ‘ä»¬å¯åŠ¨äº†ä¸€ä¸ª8080ç«¯å£çš„æœ¬åœ°æœåŠ¡
    æ¥ä¸‹æ¥æˆ‘ä»¬è®¿é—® http://localhost:8080
    é—®é¢˜æ˜¯æ— æ³•å®šä½åˆ°æˆ‘ä»¬çš„htmlæ¨¡æ¿ æ‰€ä»¥æˆ‘ä»¬éœ€è¦è¿›è¡Œé…ç½®ä¸‹
    devServer: { // å¼€å‘æœåŠ¡å™¨çš„é…ç½®
        port: 3000, // è¿è¡Œåœ¨3000ç«¯å£å·ä¸Š
        progress: true, // æ˜¾ç¤ºå¯åŠ¨çš„è¿›åº¦æ¡
        contentBase: './build' // æŒ‡å®šæ‰¾è¿™ä¸ªæ–‡ä»¶ä¸‹çš„ä»£ç 
    }
    ä¹‹åæˆ‘ä»¬éœ€è¦å»é…ç½®ä¸€ä¸‹æˆ‘ä»¬çš„è„šæœ¬ å› ä¸ºæˆ‘ä»¬æ¯æ¬¡å¯åŠ¨æœ¬åœ°æœåŠ¡çš„æ—¶å€™éœ€è¦ npx webpack-dev-server æœ‰ç‚¹å¤ªç¹çäº†ï¼Œæ‰€ä»¥æˆ‘ä»¬å°±åœ¨package.jsonä¸­çš„scriptsä¸­å»é…ç½® dev-server: 'npx webpack-dev-server'è¿™æ ·æˆ‘ä»¬å°±å¯ä»¥ç›´æ¥ä½¿ç”¨npm run dev-server æ¥å¯åŠ¨æœ¬åœ°çš„æœåŠ¡

#### 1.3.2ä½¿ç”¨æ’ä»¶è‡ªåŠ¨åˆ›å»ºHTMLæ–‡ä»¶
    let HtmlWebpackPlugin = require('html-webpack-plugin');//å¼•å…¥è‡ªåŠ¨åˆ›å»ºç”Ÿæˆhtmlæ¨¡æ¿çš„æ’ä»¶
    è¿™é‡Œæˆ‘ä»¬éœ€è¦è£…ä¸€ä¸‹è¿™ä¸ªæ’ä»¶ yarn add html-webpack-plugin -D
     plugins: [// æ”¾ç€æ‰€æœ‰çš„webpackæ’ä»¶
        new HtmlWebpackPlugin({
            template: './src/index.html',
            filename: 'index.html'
        })
    ]

